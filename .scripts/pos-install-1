#!/bin/bash
# Author: Paulo Jerônimo (@paulojeronimo, pj@paulojeronimo.info)

THIS_DIR=`cd $(dirname "$0"); echo -n $PWD`
source "$THIS_DIR/config"

echo "mandando a $VM_NAME parar"
#VBoxManage controlvm $VM_NAME acpipowerbutton
VBoxManage controlvm $VM_NAME poweroff

echo -n "aguardando até a $VM_NAME parar ... "
while true; do VBoxManage list runningvms | grep -q $VM_NAME && sleep 1 || break; done
echo ok

echo "removendo o CD de instalação"
VBoxManage storageattach $VM_NAME --storagectl "IDE Controller" --port 1 --device 0 --type dvddrive --medium emptydrive

echo "reiniciando a $VM_NAME"
VBoxManage startvm $VM_NAME

cat <<'EOF'

Aguarde a VM ser iniciada ...
Logue-se como aluno (senha @alun0123) e execute os seguintes comandos:

# se precisar configurar seu teclado para um padrão brasileiro, execute:
sudo loadkeys br-abnt2

# remova os kernels antigos, limpe o cache de pacotes e o histórico de comandos:
sudo package-cleanup -y --oldkernels --count=1
d=/var/cache/yum/; sudo bash -c "rm -rf $d; mkdir -p $d"
history 
# ------------------------------------------------------------------------------

Agora, volte para a máquina HOST (a que está executando o VirtualBox) e execute:

./pos-install-2
EOF
